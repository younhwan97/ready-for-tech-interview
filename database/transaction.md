## 트랜잭션(Transaction)

### 트랜잭션이란?

여러 읽기/쓰기를 논리적으로 하나로 묶어주는 행위

트랜잭션 시작 ➡️ 여러 쿼리 실행 ➡️ 커밋(모두 반영) <strong>또는</strong> 롤백(모두 반영 x)

<br/>

트랜잭션이 없다면❓❓

만약 데이터를 이용해 작업을 하다가 문제가 발생하면 <strong>최소한</strong> 초기 상태로는 돌려놓아야 한다. 이때 트랜잭션이 없다면 해당 과정이 굉장히 힘들 수 있다.

트랜잭션을 사용하면 중간에 문제가 발생해도 전부 롤백만하면 되기 때문에 개발자의 부담이 상당히 줄어든다. 👍

<br/>

### 트랜잭션 상태

![트랜잭션_상태전이도](https://user-images.githubusercontent.com/78298663/196676879-cb604c6c-53ea-4d26-82f4-cc772c3e90f0.png)

위 그림에서 볼 수 있듯이 Commit 또는 Rollback 한가지 결과만 발생한다. (All or Nothing)

<br/>

### 트랜잭션의 특징(ACID)

- 원자성(Atomicity): 트랜잭션이 모두 DB에 반영되거나, 하나라도 실패했을 시 모두 반영되지 않아야 한다. (커밋 or 롤백 한가지만!)
- 일관성(Consistency): 트랜잭션 결과 데이터의 상태는 일관성이 있어야한다. 
    * 트랜잭션이 일어난 이후 데이터가 DB의 규칙이나 제약을 만족해야한다.
    * 잘못된 예시: 모든 고객이 이름을 가지고 있어야하는 DB에서 고객의 이름을 삭제하는 트랜잭션
- 고립성(Isolation): 여러 트랜잭션이 동시에 실행되고 있을 때, 각 트랜잭션은 서로 독립적으로 실행되어야 한다.
- 지속성(Durability): 트랜잭션이 성공적으로 완료되었으면, 그 결과는 영구적으로 DB에 반영되어야 한다.
    * 만약 런타임 오류나 시스템 오류가 발생하더라도, 해당 기록은 영구적으로 남아있어야 한다.

<br/>

### 트랜잭션 격리

#### Race Condition

여러 클라이언트가 같은 데이터에 접근할 때 문제 발생

👉 트랜잭션을 서로 <strong>격리</strong>해서 다른 트랜잭션이 영향을 주지 못하게 해야한다. 가령 모든 트랜잭션을 줄을 세워 순서대로 실행하도록 하는 방법이 될 수 있다.